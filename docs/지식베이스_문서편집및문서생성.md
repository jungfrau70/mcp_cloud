# 지식베이스 문서 편집 및 생성 UX 제안서

## 1. 목적
내·외부 지식을 빠르게 축적/편집/재활용하여 “학습-생성-정제” 사이클을 최소한의 전환 비용으로 반복할 수 있는 **통합 문서 작업 환경(Authoring Workspace)** 설계.

## 2. 핵심 사용자 유형(Persona)
| 사용자 | 1차 목적 | 핵심 Pain Point | 기대 기능 |
|--------|---------|----------------|-----------|
| 콘텐츠 작성자(강사/엔지니어) | 빠른 초안 & 구조화 | 레이아웃 전환 / 복사 붙여넣기 반복 | 다중 패널, AI 보조, 템플릿 |
| 리뷰어(리드/QA) | 품질/정합성 확인 | 변경 diff 파악 어려움 | 버전/히스토리, 강조 diff, 승인 워크플로우 |
| 학습자 | 최신 자료 소비 | 오래된/중복 문서 | 신뢰도 지표, 요약, 추천 |
| 운영자(플랫폼 관리) | 지식 자산 구성 최적화 | 사용률/중복 파악 어려움 | 메타데이터/사용 통계 대시보드 |

## 3. 대표 사용자 시나리오 (End‑to‑End)
### S1. 외부 자료로 새 문서 초안 생성 → 내부 KB 저장 → 즉시 편집
1. 검색 패널에서 주제 입력, 소스(Web/News/Docs) 선택, [생성] 클릭.
2. 진행 패널(progress)에서 단계(검색→추출→생성) 실시간 확인. 취소 가능.
3. 완료 시 자동으로 편집 탭이 열리고 Markdown 초안이 에디터에 로드.
4. 우측 AI 패널에서 “요약”, “목차 자동생성”, “코드 블록 정리” 후 적용.
5. [저장 & 인덱스 재생성] 1클릭으로 RAG 인덱스 업데이트.

### S2. 기존 문서 개선(Refine) 워크플로우
1. 파일 트리에서 문서 선택 → 뷰어(Preview) 패널에서 읽기.
2. 상단 퀵 액션: [편집] / [AI 개선 제안] / [버전 비교].
3. AI 개선 제안 클릭 → 사이드 패널에 “제안 목록(문장 재작성, 구조 재조정, 누락 섹션 추천)” 제공.
4. 선택적 적용(Inline Patch) → 변경 diff 표시.
5. 코멘트(리뷰 모드) 후 승인 → 새 버전 태그 생성.

### S3. 다중 소스 합성 문서(Comparison / Reference) 생성
1. Multi-select 모드에서 2~5개 문서를 선택 → [AI 비교 문서 생성].
2. AI가 차이점/공통점 테이블, 권장 선택 기준 생성.
3. 초안이 새 Draft 워크스페이스에 열리고 저장 전까지 “draft” 상태 메타 부여.

### S4. 빠른 스니펫 추가(Atomic Knowledge Capture)
1. 콘솔/터미널 또는 실시간 세션 중 하이라이트 → “지식 스니펫 추가” 단축키.
2. 미니 입력 창(Modal): 제목, 태그, 카테고리 → 저장 시 자동 규격 템플릿 래핑.
3. 밤 시간대 배치 작업으로 스니펫을 관련 장/섹션에 자동 제안(머지 대기열).

### S5. PDF/슬라이드 파생
1. 문서 탭에서 [Export] → Markdown → Slide (reveal.js) → PDF.
2. Export 설정(테마, 코드 하이라이트, 챕터 분할 규칙) → 미리보기 → 다운로드.

## 4. 정보 구조(IA) & 레이아웃 개선안
```
┌─────────────────────────────────────────────────────────────┐
│ Top Bar: 글로벌 검색 ⌘K | 생성(New) | Export | 통계 | 설정      │
├──────────────┬─────────────────────────────┬───────────────┤
│ File Tree    │  Center: Editor / Preview  │  Right Panel  │
│ (모드토글)   │  - 탭(Preview/Edit/Diff)   │  - AI 도우미   │
│              │  - 위쪽 Sub-toolbar        │  - 히스토리     │
│              │    (Save, Format, Outline) │  - 메타데이터   │
├──────────────┴────────────┬────────────────┴───────────────┤
│ Bottom: 진행 상태(생성/색인) | 단축키 힌트 | LLM 쿼터 상태         │
└─────────────────────────────────────────────────────────────┘
```

구분 | 현재 | 제안 개선
----|------|---------
탐색/검색 | 탭 전환 필요 | 좌: 트리 / 상단: 통합 검색 (문서+컨텐츠+태그, AI 질의) | 
외부 생성 | 별도 탭 | 동일 검색창에서 ‘AI 생성’ CTA 분기 | 
편집/뷰어 | 단일 패널 | Preview/Edit/Diff 탭 + Live Outline(헤더 트리) | 
AI 도우미 | 제한 | Context-aware Actions (요약, 리라이팅, 번역, 테스트생성) | 
버전관리 | 미흡 | Local history + 저장 시 diff modal | 
메타데이터 | 최소 | 태그, 난이도, 업데이트 필요도(staleness), 출처 리스트 | 
진행상태 | 문서 생성 한정 | 색인 재빌드, LLM 쿼터, 백그라운드 작업 큐 통합 | 

## 5. 기능 세부 항목
### 5.1 에디터(핵심)
- Split View: 좌 Markdown / 우 Preview (toggle).
- Heading Outline 사이드 바(문서 내 점프, 드래그로 순서 재배치).
- AI Inline Commands: 텍스트 드래그 → 퀵툴바(요약/확장/번역/코드정리).
- 자동 저장(초안) + 명시적 Commit 저장(버전 증가).
- Diff Mode: HEAD vs Working vs 선택 버전.
 - Diff Mode: HEAD vs Working vs 선택 버전.

### 5.8 API 상세 스펙
엔드포인트 | 메서드 | 목적 | 요청 Body/Query 핵심 필드 | 2xx 응답 요약 | 오류 (주요)
-----------|--------|------|---------------------------|---------------|-------------
`/api/kb/item` | GET | 단일 문서 조회 | `?path=` | `{path, content, meta}` | 404 없음
`/api/kb/item` | PATCH | 문서 저장 & 버전 생성 | `{path, content, message?}` | `{success, version_id, updated_at}` | 409 충돌(동시수정)
`/api/kb/versions` | GET | 버전 목록 | `?path=` | `{versions:[{id,msg,ts,size,author}]}` | -
`/api/kb/diff` | GET | 두 버전 diff | `?path=&v1=&v2=` | `{diff_format:'unified', hunks:[...]}` | 400 파라미터
`/api/kb/outline` | POST | 헤더 추출 | `{content}` | `{outline:[{level,text,line}]}` | 413 너무큼
`/api/kb/quality` | POST | 품질 지표 | `{content}` | `{scores, suggestions}` | 422 형식오류
`/api/kb/ai/transform` | POST | 선택 텍스트 AI 변환 | `{op, content, selection?}` | `{result, meta:{tokens,model}}` | 429 쿼터
`/api/kb/compose/external` | POST | 외부 자료 합성 생성 | `{topic,sources[],options?}` | `{task_id}` (비동기) | 429, 503
`/api/kb/tasks/:id` | GET | 태스크 상태 조회 | path param | `{status, stage, progress, output?}` | 404 없음
`/api/kb/tasks/ws` | WS | 실시간 이벤트 | - | `event JSON` 스트림 | -
`/api/kb/export` | POST | PDF/슬라이드 변환 | `{path, format}` | 파일 스트림 / `{download_url}` | 400 포맷

예시: 문서 저장 PATCH 요청
```json
{
	"path": "cloud/aws/vpc.md",
	"content": "# AWS VPC\n...",
	"message": "Add NAT Gateway section"
}
```
응답
```json
{
	"success": true,
	"version_id": 18,
	"updated_at": "2025-08-21T10:33:12Z"
}
```

Diff 응답 (발췌)
```json
{
	"diff_format": "unified",
	"hunks": [
		{"header":"@@ -10,3 +10,6 @@","lines":["-기존 내용","+추가 내용"]}
	]
}
```

AI Transform 요청/응답 (요약)
```json
{"op":"summarize","content":"장문텍스트 ..."}
```
```json
{"result":"요약된 문장들","meta":{"tokens":512,"model":"gemini-1.5-flash"}}
```

### 5.2 AI 보조 패널
액션 카테고리 | 예시 기능
--------------|----------
구조 | 목차 생성, 섹션 재배치 제안
품질 | 중복 문장 제거, 가독성/난이도 분석
지식 | 관련 내부 문서 추천, 누락 개념 탐지
번역 | 한↔영 양방향 문장/섹션 번역
요약 | 슬라이드용 Bullet 요약, TL;DR 생성
테스트 | 학습용 퀴즈/플래시카드 자동 생성

### 5.3 외부 자료 기반 생성 개선
현 문제 | 개선 알고리즘
--------|---------------
단일 prompt 의존 | 다단계: (수집→클러스터→요약→구조화→검증)
출처 신뢰도 미표시 | 도메인 평판/연령 기반 가중치 → 출처 섹션 점수화
장문 그대로 삽입 위험 | Chunk 요약 + 중복 제거 (MinHash / SimHash)
실패 시 불명확 | "어느 단계" 실패 로그/재시도 버튼
쿼터 초과 빈번 | 모델 회전 + 로컬 RAG fallback 메시지 개선

### 5.4 문서 메타 & 품질 지표
필드 | 설명 | 산출 방식
-----|------|---------
freshness_score | 최신성 (0–100) | 마지막 업데이트와 관련 기술 릴리스 빈도 비교
readability | 가독성 | 한글 가독성 지수(문장 길이, 어휘 다양성)
source_coverage | 출처 다양성 | 사용된 도메인 수 / 총 요구 도메인 수
ai_generated_ratio | AI 생성 비율 | 최초/수정 토큰 대비 사용자 편집 비율
review_status | 검토 상태 | draft/pending/approved

### 5.5 단축키 (예시)
키 | 기능
---|----
Ctrl/Cmd + K | 글로벌 검색 / 명령 팔레트
Ctrl/Cmd + S | Commit 저장
Ctrl/Cmd + Shift + S | 새 버전 태그 + 인덱스 재생성
Ctrl/Cmd + / | AI 명령 팔레트
Alt + ↑/↓ | 헤더 블록 이동
Ctrl/Cmd + B | Bold 토글 (Markdown)

### 5.6 백엔드 확장 포인트
모듈 | 추가 API | 설명
-----|----------|----
문서 버전 | GET /kb/versions?path= | 버전 목록
Diff | GET /kb/diff?path&v1&v2 | 두 버전 차이
품질지표 | POST /kb/quality | 텍스트 분석 결과
AI 보조 | POST /kb/ai/transform | 선택 텍스트 변환
Outline | POST /kb/outline | 헤딩 추출 및 구조화
Export | POST /kb/export | slide/pdf 변환 파이프라인

### 5.7 진행/상태 이벤트 스트림
- WebSocket: /ws/kb-tasks
이벤트 예: `{ type: 'indexing', progress: 0.42 }`, `{ type: 'generation', stage: 'summarizing' }`
- 재연결 및 최근 N개 버퍼 제공.

## 6. 단계별 도입 로드맵
Phase | 기간 | 목표 | 주요 산출물
------|------|------|-----------
P1 | 0-4주 | 핵심 편집 + 외부생성 안정화 | Split Editor, 진행 상태 개선, 실패 로그
P2 | 5-8주 | AI 보조 & 버전관리 | Inline Commands, Diff, Versions API
P3 | 9-12주 | 품질/메타 지표 & Export | Quality API, Outline, PDF/Slide Export
P4 | 13주+ | 지능형 추천 & 워크플로우 | Update Suggestion Graph, Review Flow

### 6.1 Phase별 작업 티켓 (요약)
#### P1 (0-4주)
ID | 유형 | 제목 | 완료조건
---|-----|------|---------
P1-BE-1 | BE | KB PATCH 저장 API | 200 & version_id 증가, race 409 처리
P1-BE-2 | BE | Outline API | H1~H4 level 포함 JSON 반환
P1-BE-3 | BE | 외부생성 단계 로깅 | stage_times 필드 채움
P1-FE-1 | FE | Split Editor | Markdown/Preview 동기 스크롤
P1-FE-2 | FE | 상단 통합 검색바 | 검색 & AI 생성 CTA 동작
P1-FE-3 | FE | 진행 이벤트 구독 | WebSocket 재연결 & progress 표시
P1-QA-1 | QA | E2E 외부생성 | 성공/실패/취소 케이스 통과

#### P2 (5-8주)
ID | 유형 | 제목 | 완료조건
---|-----|------|---------
P2-BE-1 | BE | Versions API | 최신 순 정렬, 0개 처리
P2-BE-2 | BE | Diff API | 800KB 문서 <500ms(p95)
P2-BE-3 | BE | AI Transform API | 5 ops 지원
P2-FE-1 | FE | Diff 뷰 UI | Add/Delete 강조, 라인점프
P2-FE-2 | FE | AI Inline Toolbar | 선택 시 팝오버 150ms 내 렌더
P2-FE-3 | FE | 버전 히스토리 패널 | 선택 → diff 즉시 로드
P2-QA-1 | QA | 회귀 테스트 세트 | 핵심 API 커버리지 80%+

#### P3 (9-12주)
ID | 유형 | 제목 | 완료조건
---|-----|------|---------
P3-BE-1 | BE | Quality API | 4 지표 + suggestions 배열
P3-BE-2 | BE | Export API | pdf/slides 둘 다 반환
P3-BE-3 | BE | Source Metrics | coverage 필드 포함
P3-FE-1 | FE | 품질 패널 | 게이지/색상 임계치 적용
P3-FE-2 | FE | Export UI | 미리보기 2초 내 렌더
P3-FE-3 | FE | Live Outline Drag | 순서 변경 즉시 적용
P3-QA-1 | QA | 성능 측정 | 지표 리포트 커밋

#### P4 (13주+)
ID | 유형 | 제목 | 완료조건
---|-----|------|---------
P4-BE-1 | BE | 추천 그래프 | 관련 문서 Top5 API
P4-BE-2 | BE | 리뷰 워크플로 API | 상태 전이 draft→approved
P4-FE-1 | FE | 추천 섹션 | 클릭 추적 이벤트 발행
P4-FE-2 | FE | 리뷰 UI | 코멘트/승인 패널
P4-FE-3 | FE | Staleness 대시보드 | 오래된 순 정렬/필터
P4-QA-1 | QA | 부하/장기 테스트 | 20 동시 편집 안정성

## 7. 성공 측정 KPI
지표 | 초기 Baseline | 목표(6개월)
-----|--------------|-------------
문서 초안 평균 생성 시간 | >15분 | <3분
AI 생성 문서 후 평균 편집 횟수 | 10+ | 4 이하
문서 재사용(참조) 비율 | 20% | 45%+
중복 문서 비율 | 18% | 8% 이하
LLM 실패 재시도율 | 25% | 10% 이하
리뷰 승인 평균 소요 | 5일 | 2일

## 8. 리스크 & 대응
리스크 | 영향 | 대응
-------|------|----
LLM 쿼터 소진 | 생성 실패 증가 | 모델 풀 회전, 캐시, 로컬 Retrieval fallback 메시지 개선
저품질 외부 출처 | 신뢰도 저하 | 도메인 화이트리스트 + 점수 기반 필터링
대형 문서 Diff 비용 | 성능 저하 | 헤더 단위 Chunk diff + lazy render
동시 편집 충돌 | 데이터 유실 | optimistic lock + 409 충돌 해결 UI
개인정보 유출 | 규제 리스크 | PII 검출 필터 + 전송 전 마스킹

## 9. 요약
이 제안은 “탐색/검색 분리, 즉시 편집, 다단계 AI 생성, 버전 & 품질 가시성”을 통해 생산성을 크게 향상시키는 구조를 제시합니다. 단계적 도입으로 리스크를 통제하면서도 사용자 가치를 빠르게 전달할 수 있습니다.

## 10. UI 와이어프레임 (ASCII 개략)
### 10.1 상단 검색 & 생성
```
┌────────────────────────────────────────────────────────────────────────────┐
│ 🔍  [검색어 또는 문서 주제.............................................] (AI 생성) │
└────────────────────────────────────────────────────────────────────────────┘
Enter: 내부 검색, (AI 생성): 외부 합성 파이프라인 시작
```

### 10.2 Split Editor / Outline
```
┌───────────┬──────────────────────────┬──────────────────────────┐
│ Outline   │ Markdown                │ Preview                  │
│ H1 ...    │ # 제목                  │ 렌더 결과                │
└───────────┴──────────────────────────┴──────────────────────────┘
툴바: Save | Diff | Format | Export | AI ▼
```

### 10.3 Diff 뷰
```
┌──────────────────────────────────────────────────────────┐
│ HEAD ↔ v12 (Unified)                                     │
│ - 삭제 라인                                              │
│ + 추가 라인                                              │
│ ~ 컨텍스트                                               │
└──────────────────────────────────────────────────────────┘
필터: [All] [Add] [Del] [Mod]
```

### 10.4 AI 제안 패널
```
┌────────────────────┐
│ AI 제안            │
│ [구조] H2 재배치   │
│ [품질] 긴 문장 ... │
│ [요약] Bullet ...  │
│ Apply | Dismiss    │
└────────────────────┘
```

> 실제 하이파이 이미지는 `/docs/images/` 추가 예정.

---
**문서 버전:** 0.2
**최종 수정:** 2025-08-21
**담당:** MCP Cloud AI Assistant
