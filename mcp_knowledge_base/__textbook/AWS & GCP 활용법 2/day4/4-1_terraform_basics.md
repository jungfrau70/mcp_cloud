# 4-1. Terraform 소개 및 기본 사용법

이 챕터에서는 "코드로 인프라 관리하기(Infrastructure as Code, IaC)"의 개념을 배우고, 대표적인 IaC 도구인 Terraform의 핵심 개념과 기본 명령어 사용법을 익힙니다. 코드 기반의 자동화되고 재현 가능한 인프라 관리의 세계로 들어가는 첫걸음입니다.

---

### Terraform 핵심 개념

Terraform은 몇 가지 핵심적인 개념 위에 구축되었습니다. 이를 이해하는 것이 Terraform을 마스터하는 열쇠입니다.

- **Provider:** 클라우드 플랫폼(AWS, GCP, Azure 등)이나 서비스(GitHub, Datadog 등)와의 연동을 담당합니다. 어떤 API와 통신할지를 정의합니다.
- **Resource:** 프로비저닝할 인프라의 최소 단위입니다. EC2 인스턴스, S3 버킷, VPC 등 모든 것이 리소스가 될 수 있습니다. `resource "aws_instance" "my_server" { ... }` 와 같은 형태로 선언합니다.
- **State:** Terraform이 관리하는 인프라의 현재 상태를 기록하는 파일(`terraform.tfstate`)입니다. 코드와 실제 인프라 간의 매핑 정보를 담고 있으며, 매우 중요하게 다루어야 합니다.
- **Variable:** 코드의 재사용성을 높이기 위해 사용됩니다. 리전, 인스턴스 타입 등 변경될 수 있는 값들을 변수로 분리하여 관리할 수 있습니다.
- **Output:** 생성된 인프라의 정보(예: EC2 인스턴스의 IP 주소, S3 버킷의 이름)를 터미널에 출력하거나 다른 Terraform 모듈에서 사용할 수 있도록 정의합니다.

### Terraform 기본 명령어

Terraform은 간단한 몇 가지 명령어로 인프라의 전체 생명주기를 관리합니다.

1.  **`terraform init`**
    -   작업 디렉터리를 초기화하는 가장 첫 단계의 명령어입니다.
    -   코드에 선언된 Provider를 다운로드하고, 백엔드 및 모듈을 설정합니다.
    -   Terraform 코드를 작성하거나 내려받은 후, 가장 먼저 실행해야 합니다.

2.  **`terraform plan`**
    -   작성된 코드를 현재 인프라 상태(State)와 비교하여, 어떤 리소스가 생성/변경/삭제될지를 미리 보여주는 "실행 계획"을 생성합니다.
    -   실제 인프라에 변경을 가하기 전에, 예상되는 변경 사항을 안전하게 검토할 수 있는 매우 중요한 단계입니다.

3.  **`terraform apply`**
    -   `plan` 단계에서 생성된 실행 계획을 실제로 인프라에 적용합니다.
    -   "yes"를 입력해야만 실행되며, 이 명령을 통해 코드가 실제 클라우드 리소스로 만들어집니다.

4.  **`terraform destroy`**
    -   Terraform 코드로 관리되는 모든 인프라를 삭제합니다.
    -   실습 후 리소스를 정리하거나, 더 이상 필요 없는 환경을 제거할 때 사용합니다. `apply`와 마찬가지로 매우 강력한 명령어이므로 신중하게 사용해야 합니다.

---

### 💡 알아두면 좋은 점

- **절대, 절대, 상태 파일을 수동으로 수정하지 마세요:** `terraform.tfstate` 파일은 Terraform이 실제 인프라와 코드를 매핑하는 두뇌와 같습니다. 이 파일을 직접 수정하는 것은 매우 위험하며, 인프라 상태가 꼬이는 가장 빠른 지름길입니다. 상태를 변경해야 할 때는 `terraform import`나 `terraform state`와 같은 명령어를 사용하세요.
- **모듈화의 중요성:** 프로젝트가 커지면 하나의 `main.tf` 파일로 모든 것을 관리하기는 불가능합니다. Terraform의 `모듈(Module)` 기능을 사용하면 VPC, 데이터베이스, 애플리케이션 등 인프라의 각 부분을 재사용 가능한 블록으로 만들어 체계적으로 관리할 수 있습니다.
