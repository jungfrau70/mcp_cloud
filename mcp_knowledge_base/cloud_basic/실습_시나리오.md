# 클라우드 실습 시나리오 (Azure · AWS · GCP)

본 문서는 Chapter 1~4의 실습을 하나의 흐름으로 수행할 수 있도록 정리한 통합 가이드입니다. 
각 단계는 이론-실습-검증-트러블슈팅으로 구성되어 있으며, 플랫폼별(Azure/AWS/GCP) 경로와 CLI 스니펫을 제공합니다.


---

## Chapter 1: 클라우드 계정 및 IAM

### 개요 및 목표
- 최소 권한 원칙 기반 사용자/그룹/역할 설계
- MFA/조건부 접근/권한 경계 적용

### 준비물
- Azure/AWS/GCP 콘솔 및 CLI(az, aws, gcloud) 로그인

### 실습 1: 사용자/그룹/역할 할당
- Azure: Subscription/Resource group → Access control (IAM)
```
az ad group create --display-name DevTeam --mail-nickname devteam
az role assignment create \
  --assignee-object-id <USER_OR_GROUP_OBJECT_ID> \
  --role "Reader" \
  --scope "/subscriptions/<SUB_ID>/resourceGroups/<RG_NAME>"
```
- AWS: IAM → Users/Groups/Policies → MFA
```
aws iam create-user --user-name dev-user
aws iam create-group --group-name DevTeam
aws iam add-user-to-group --user-name dev-user --group-name DevTeam
aws iam attach-group-policy --group-name DevTeam \
  --policy-arn arn:aws:iam::aws:policy/ReadOnlyAccess
```
- GCP: IAM & Admin → IAM → 역할 바인딩, 2단계 인증
```
gcloud projects add-iam-policy-binding <PROJECT_ID> \
  --member=user:<EMAIL> --role=roles/viewer
```

### 실습 2: 서비스 계정/정책 고도화
- 최소 권한 정책/권한 경계/조건부 접근 구성

### 검증 체크리스트
- 허용/거부 테스트, MFA 증빙, 태그/라벨 기반 제어 검토

### 트러블슈팅
- 스코프/상속/조건 점검, 명시적 Deny 우선순위 확인

### 팀 역할 기반 실습 가이드
- Finance: 태깅/예산/비용 알림 표준화, 무태그 리소스 탐지 리포트
- DevOps: IAM 베이스라인 IaC 템플릿/파이프라인, 온보딩 자동화
- Development: 서비스 계정 최소 권한 검증, MFA/비밀관리 준수
- SRE: 접근 관련 SLI/SLO, 정책 위반 탐지/알림, 런북 정비

---

## Chapter 2: VM과 웹 서비스 배포

### 개요 및 목표
- 단일 VM 웹 서버 → 고가용성(LB+오토스케일)

### 기본 실습: 단일 VM + 웹서버
- 공통: Ubuntu 22.04, HTTP/SSH 최소 허용 → 브라우저로 "Hello, Cloudy!" 확인

### 고가용성 (플랫폼별)
- Azure: VM 2대 + Load Balancer + VMSS(autoscale)
```
az vmss create -g rg-lab -n vmss-web --image Ubuntu2204 --upgrade-policy-mode automatic \
  --instance-count 2 --vm-sku Standard_B1s --lb-sku Standard
az monitor autoscale create -g rg-lab -n scale-web --resource "vmss-web" \
  --min-count 2 --max-count 4 --count 2
```
- AWS: EC2 2대 + ALB + ASG(Min=2, Max=4)
```
aws elbv2 create-load-balancer ...
aws autoscaling create-auto-scaling-group --auto-scaling-group-name web-asg \
  --min-size 2 --max-size 4 --desired-capacity 2 --vpc-zone-identifier <SUBNETS>
```
- GCP: MIG + HTTP(S) LB + autoscaler(cpu 70%)
```
gcloud compute instance-templates create web-tpl --machine-type=e2-micro \
  --image-family=ubuntu-2204-lts --image-project=ubuntu-os-cloud
gcloud compute instance-groups managed create web-mig --template=web-tpl --size=2 --zone=asia-northeast3-a
gcloud compute autoscalers create web-as --target-instance-group=web-mig \
  --target-cpu-utilization=0.7 --min-num-replicas=2 --max-num-replicas=4 --zone=asia-northeast3-a
```

### 운영 체크리스트
- SSH 소스 제한, 키/패치 관리, 헬스체크 정상, 비용 최적화(작은 타입/스팟/스케줄)

### 팀 역할 기반 실습 가이드
- Finance: Compute/LB/NAT 비용 대시보드, 근무시간 외 중지 정책
- DevOps: VM/LB/ASG/MIG 모듈 제공, PR→Plan→승인→Apply 자동화
- Development: 템플릿으로 배포, 헬스체크 구현, 간단 부하테스트
- SRE: 오토스케일 정책 튜닝, 장애 런북, 카나리/블루-그린 초안

---

## Chapter 3: 스토리지와 정적 웹/아카이빙

### 개요 및 목표
- 정적 웹사이트 안전 공개, 라이프사이클/버전관리 기반 비용 최적화

### 실습 1: 정적 웹사이트 호스팅
- Azure
```
az storage account create -n <acct> -g rg-lab -l koreacentral --sku Standard_LRS
az storage blob service-properties update --account-name <acct> --static-website \
  --index-document index.html --404-document 404.html
az storage blob upload-batch -s ./site -d '$web' --account-name <acct>
```
- AWS
```
aws s3 mb s3://lab-static-<uid>
aws s3 sync ./site s3://lab-static-<uid>
```
- GCP
```
gsutil mb -l ASIA-NORTHEAST3 gs://lab-static-<uid>
gsutil cp -r ./site/* gs://lab-static-<uid>
gsutil web set -m index.html -e 404.html gs://lab-static-<uid>
gsutil iam ch allUsers:objectViewer gs://lab-static-<uid>
```

### 실습 2: 라이프사이클/버전관리/아카이빙
- 30일 경과 → 저비용 클래스 이동, 90일 후 삭제, 버전관리 복구 실습, 비용 비교

### 운영 체크리스트
- 공개 최소화(서명 URL/정책, CDN+WAF), 암호화/전송 보호, 액세스 로그

### 팀 역할 기반 실습 가이드
- Finance: 클래스/버킷별 비용 리포트, 라이프사이클 절감 효과 분석
- DevOps: 버킷/웹/정책 IaC, 퍼블릭 기본 차단과 예외 승인 프로세스
- Development: 정적 자산 빌드/배포 자동화, 버전 롤백 테스트
- SRE: 공개 객체/권한 변경 탐지, 보존/파기 절차 점검

---

## Chapter 4: 네트워크 & DNS

### 개요 및 목표
- 퍼블릭/프라이빗 서브넷 분리, NAT, LB, DNS 연결

### 실습 1: 네트워크 기초
- Azure: VNet/Subnet/NSG, Bastion/Jumpbox
- AWS: VPC/Subnet/IGW/NAT GW/Route, SG/NACL
- GCP: VPC/Firewall/Cloud NAT

### 실습 2: LB & DNS
- L4/L7 LB 구성 → 헬스체크 OK 확인
- DNS(Route53/Cloud DNS/Azure DNS) A/AAAA/CNAME 연결

### 체크리스트
- 인바운드 최소/소스 제한, 아웃바운드 제어, 멀티 AZ/존, 모니터링/알림

### 트러블슈팅
- SG/NSG/Firewall → 라우팅 → 헬스체크 순서 점검
- DNS 전파/TTL/레코드 설정 확인

### 팀 역할 기반 실습 가이드
- Finance: NAT/LB/데이터 전송 비용 시각화/알림, 절감안
- DevOps: 네트워크 IaC 표준/PR 리뷰/테스트 환경 자동화, 플로우 로그 수집
- Development: 도메인 레코드 테스트, 헬스 엔드포인트 제공, 최소 포트 원칙
- SRE: 멀티AZ/DR, 네트워크 SLI/SLO, 네트워크 런북

---

## 사전준비 & 운영 시나리오(요약)
- 사전준비: 계정/권한(참가자=Contributor), CLI 설치/인증, 명명/태깅/리전, 예산/알림, 샘플 자산(site/), 비밀관리 선택, 팀별 책임자 지정
- 운영 시나리오: Git 리포지토리(IaC/app) → PR(DevOps) → Plan/Security Scan → 재무 검토(비용) → 승인 → 배포 → 모니터링/SRE 런북 → 비용/정책 리포트

---

## 종합 제출물
- 아키텍처 다이어그램(각 Chapter 구성 반영)
- 실행 명령/콘솔 경로 포함한 실습 기록(마크다운)
- 주요 스크린샷(MFA, LB 헬스, 정적 사이트, DNS, 모니터링)
- 개선 포인트(보안/비용/운영) 최소 3가지

> 보안 주의: 교육/데모 외 퍼블릭 공개를 지양하고, CDN/WAF/사설 엔드포인트/서명 URL을 권장합니다.

---

## 자동화 실행 가이드

### CLI 스크립트 경로
- AWS: `cloud_basic/automation/cli/aws/ch1_iam.sh`, `ch2_vm.sh`, `ch3_storage.sh`, `ch4_network.sh`
- Azure: `cloud_basic/automation/cli/azure/ch1_iam.sh`, `ch2_vm.sh`, `ch3_storage.sh`, `ch4_network.sh`
- GCP: `cloud_basic/automation/cli/gcp/ch1_iam.sh`, `ch2_vm.sh`, `ch3_storage.sh`, `ch4_network.sh`

실행 예:
```bash
chmod +x cloud_basic/automation/cli/aws/*.sh
AWS_PROFILE=default AWS_REGION=ap-northeast-2 bash cloud_basic/automation/cli/aws/ch2_vm.sh
```

### Terraform 예제 경로
- AWS: `cloud_basic/automation/terraform/aws/ch1_iam`, `ch2_vm`, `ch3_storage`, `ch4_network`
- Azure: `cloud_basic/automation/terraform/azure/ch2_vm`, `ch3_storage`, `ch4_network`
- GCP: `cloud_basic/automation/terraform/gcp/ch2_vm`, `ch3_storage`, `ch4_network`

실행 예:
```bash
cd cloud_basic/automation/terraform/aws/ch2_vm
terraform init && terraform apply -auto-approve
```

### 추가 자동화
- Terraform(IAM):
  - Azure: `cloud_basic/automation/terraform/azure/ch1_iam`
  - GCP: `cloud_basic/automation/terraform/gcp/ch1_iam`
- CI 파이프라인: `.github/workflows/iac-ci.yml` (fmt/validate + tfsec + checkov)
- 예산 알림 스크립트:
  - AWS: `cloud_basic/automation/cli/budget/aws_budget.sh`
  - Azure: `cloud_basic/automation/cli/budget/azure_budget.sh`
  - GCP: `cloud_basic/automation/cli/budget/gcp_budget.sh`

상세 가이드는 `cloud_basic/자동화_사용안내.md`를 참고하세요.

---
◀ 이전: [실습_아키텍처개요.md](실습_아키텍처개요.md) | 다음 ▶: [Chapter1_IAM.md](Chapter1_IAM.md)

