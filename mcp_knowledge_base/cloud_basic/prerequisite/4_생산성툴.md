생산성툴 (자동화 도구)
==========

개요
--

cloud_basic의 CLI/Terraform 자동화 스크립트 사용법과 주의사항을 요약합니다.

역할 가드
-----

*   `ROLE=cost-manager` 환경에서는 IAM/프로비저닝/예산 생성 일부 스크립트가 실행을 거부합니다.
*   Terraform 실행 전 `automation/terraform/guard.sh`를 통해 역할을 확인하세요.

예산 스크립트
-------

*   AWS: `automation/cli/budget/aws_budget.sh`
    *   환경변수: `NAME`, `LIMIT_AMOUNT`, `THRESHOLDS`(예: `80,100`), `SUBSCRIBERS`(이메일 CSV)
*   GCP: `automation/cli/budget/gcp_budget.sh`
    *   환경변수: `PROJECT_ID`, `BILLING_ACCOUNT`, `DISPLAY_NAME`, `BUDGET_AMOUNT`, `THRESHOLD_PERCENT`
*   Azure: `automation/cli/budget/azure_budget.sh`
    *   환경변수: `SUB_ID`, `NAME`, `BUDGET_AMOUNT`, `THRESHOLD_PERCENT`, `CONTACT_EMAILS`, `START_DATE`, `END_DATE`

IAM 초기 스크립트
---------

*   AWS: `automation/cli/aws/ch1_iam.sh`
*   Azure: `automation/cli/azure/ch1_iam.sh`
*   GCP: `automation/cli/gcp/ch1_iam.sh`

Terraform 가드 사용 예
--------------

```
cd automation/terraform/aws/ch2_vm
source ../../guard.sh
terraform init && terraform plan
```

# 자동화 사용안내

## 개요
이 문서는 `cloud_basic/automation`에 포함된 CLI 및 Terraform 예제를 빠르게 실행하고, 문서(Chapter1~4)와 상호 참조하기 위한 안내서입니다.

## 준비
- CLI: az, aws, gcloud, terraform 설치 및 로그인
- 환경변수/파일:
```
export AWS_PROFILE=default
export AWS_REGION=ap-northeast-2
export PROJECT_ID=<GCP_PROJECT_ID>
export BILLING_ACCOUNT=<GCP_BILLING_ACCOUNT_ID>
export SUB_ID=<AZURE_SUBSCRIPTION_ID>
# 또는 env 파일 사용: cloud_basic/automation/env/{aws,azure,gcp}.env
```

## 실행 순서(예시)
1) IAM
- Azure CLI: `cloud_basic/automation/cli/azure/ch1_iam.sh`
- AWS CLI: `cloud_basic/automation/cli/aws/ch1_iam.sh`
- GCP CLI: `cloud_basic/automation/cli/gcp/ch1_iam.sh`
- Terraform: 
  - Azure: `cloud_basic/automation/terraform/azure/ch1_iam`
  - AWS: `cloud_basic/automation/terraform/aws/ch1_iam`
  - GCP: `cloud_basic/automation/terraform/gcp/ch1_iam`

2) VM
- CLI: `cloud_basic/automation/cli/*/ch2_vm.sh`
- Terraform: `cloud_basic/automation/terraform/*/ch2_vm`

3) Storage
- CLI: `cloud_basic/automation/cli/*/ch3_storage.sh`
- Terraform: `cloud_basic/automation/terraform/*/ch3_storage`

4) Network
- CLI: `cloud_basic/automation/cli/*/ch4_network.sh`
- Terraform: `cloud_basic/automation/terraform/*/ch4_network`

## Terraform 워크스페이스 / tfvars
- 워크스페이스: `terraform workspace new dev|stage|prod`
- tfvars 샘플: `cloud_basic/automation/terraform/env/dev.tfvars`
- 실행 예:
```
cd cloud_basic/automation/terraform/aws/ch2_vm
terraform init
terraform workspace select dev || terraform workspace new dev
terraform apply -var-file=../env/dev.tfvars -auto-approve
```

## CI 보안 스캔
- 워크플로: `.github/workflows/iac-ci.yml`
- 설정: `cloud_basic/automation/.tfsec.yml`, `cloud_basic/automation/.checkov.yaml`

### PR 워크플로
- 트리거: Pull Request 시 자동 실행
- 포함 경로: `cloud_basic/automation/terraform/**`, `cloud_basic/**/*.md`, `cloud_basic/automation/validate_md_links.py`
- 작업(Job)
  - terraform: `fmt -check`, `init`, `validate` + tfsec, checkov 스캔
  - docs: 마크다운 링크 무결성 검사(`validate_md_links.py`)
- 성공 기준
  - Terraform 포맷/검증 통과, tfsec/checkov 심각도 정책 내 통과(soft_fail=true는 경고)
  - 마크다운 링크 깨진 항목 없음
- 실패 시
  - PR에 체크 실패 표시, 로그에서 실패 항목 확인 후 수정

## 예산/비용 스크립트
- 예산 생성: `automation/cli/budget/{aws,azure,gcp}_budget.sh`
- 비용 리포트(요약): `automation/cli/budget/{aws,azure,gcp}_cost_report.sh`

## 문서 상호 참조
- `cloud_basic/Chapter1_IAM.md`: IAM 실습 → ch1 스크립트/TF 경로
- `cloud_basic/Chapter2_VM.md`: VM/LB → ch2 스크립트/TF 경로
- `cloud_basic/Chapter3_Storage.md`: 정적 웹/라이프사이클 → ch3 경로
- `cloud_basic/Chapter4_Network_DNS.md`: VPC/VNet/DNS → ch4 경로
- `cloud_basic/실습_시나리오.md`: 모든 경로 종합 첨부

---
◀ 이전: [3_역할분담.md](3_역할분담.md)