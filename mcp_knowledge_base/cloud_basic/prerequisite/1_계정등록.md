실습 계정 등록 (AWS · GCP · Azure)
=============================

목적
----

클라우드 실습을 시작하기 위해 필요한 계정 생성과 기본 보안 설정, 역할(IT 관리자 · 비용관리자) 분리, 예산 알림 설정, CLI 초기화를 단계별로 안내합니다. 본 문서는 `cloud_basic` 강의의 사전준비 문서와 연동되며, 자동화 스크립트 경로를 함께 제공합니다.

빠른 길잡이
------

*   사전 준비 요약: [2_공통사항.md](mdc:mcp_knowledge_base/cloud_basic/prerequisite/2_공통사항.md)
*   역할 분담: [3_역할분담.md](mdc:mcp_knowledge_base/cloud_basic/prerequisite/3_역할분담.md)
*   실습 흐름: [실습_시나리오.md](mdc:mcp_knowledge_base/cloud_basic/실습_시나리오.md)
*   Chapter 1(IAM): [Chapter1_IAM.md](mdc:mcp_knowledge_base/cloud_basic/Chapter1_IAM.md)

역할과 권한 분리(요약)
--------------

*   비용관리자(Cost Manager): 예산/비용 가시화와 알림 설정 전담. 리소스 생성/변경 권한 없음.
*   IT 관리자(DevOps/운영): 인프라 생성/변경/배포 자동화 전담. 청구/예산 화면 접근 권한 없음.
*   자동화 스크립트 방어: `ROLE=cost-manager` 환경에서 IAM/프로비저닝 스크립트 실행이 차단됩니다.
*   권장 권한 모델 단일 소스: `cloud_basic/실습_역할분담.md`의 "권장 권한 모델(요약) — 재무 vs IT 운영" 절을 기준으로 참조합니다.

사전 체크리스트(공통)
--------------

*   개인/학습용 이메일 준비, 계정 생성 시 동일 이메일 도메인 권장(조직 실습 시).
*   MFA(Authenticator 앱/보안키) 즉시 등록 — 루트/오너 권한 계정은 필수.
*   결제 수단 등록(Free Tier 포함), 예산 한도/알림 사전 설정 권장.
*   OS별 CLI 설치: Azure CLI(`az`), AWS CLI(`aws`), Google Cloud SDK(`gcloud`), 선택: `terraform`.

AWS 계정 등록 및 초기 설정
-----------------

1) 가입/로그인 및 보안
----------------

*   신규 가입 또는 제공된 랩 계정으로 로그인
*   루트 계정 보안: MFA 활성화, 액세스 키 생성 지양(필요 시 일시적 사용 후 삭제)
*   Billing 콘솔에서 IAM 결제 정보 접근 허용: Account settings → IAM access to Billing → Enable

2) 역할/사용자(권장 모델)
----------------

*   비용관리자용 그룹 `CostManagers` 생성, 정책 최소 부여
    *   `arn:aws:iam::aws:policy/job-function/Billing`
    *   `arn:aws:iam::aws:policy/AWSBudgetsReadOnlyAccess` (또는 필요 시 Actions 정책)
*   IT 관리자용 그룹 `DevTeam` 또는 서비스별 최소 권한 정책 사용(예: ReadOnlyAccess/서비스 한정)
*   예시 CLI

```
aws iam create-group --group-name CostManagers
aws iam attach-group-policy --group-name CostManagers \
  --policy-arn arn:aws:iam::aws:policy/job-function/Billing
aws iam attach-group-policy --group-name CostManagers \
  --policy-arn arn:aws:iam::aws:policy/AWSBudgetsReadOnlyAccess
```

3) 예산/알림 설정(권장)
----------------

*   스크립트: `cloud_basic/automation/cli/budget/aws_budget.sh`
*   실행 예(사전 `aws configure` 또는 SSO 설정 필요)

```
THRESHOLDS=80,100 SUBSCRIBERS=you@example.com bash cloud_basic/automation/cli/budget/aws_budget.sh
```

4) CLI 프로파일/지역 설정
----------------

*   SSO 권장: `aws configure sso` (또는 `aws configure`)
*   Windows 환경변수 예:

```
setx AWS_PROFILE default
setx AWS_REGION ap-northeast-2
```

5) 검증
------

*   `aws sts get-caller-identity` 정상 응답
*   비용관리자 계정: EC2/S3 생성 권한 차단 확인, Budgets/Cost Explorer 조회 가능
*   IT 관리자 계정: 청구/비용 화면 접근 차단, 리소스 조작 가능

GCP 계정 등록 및 초기 설정
-----------------

1) 프로젝트/결제 연결
--------------

*   Free Trial 또는 제공된 프로젝트 사용
*   Billing Account에 프로젝트 연결, 2단계 인증 활성화

2) 역할 바인딩(권장 모델)
----------------

*   비용관리자: Billing Account Viewer 또는 Costs Manager — 프로젝트에는 `roles/viewer`
*   IT 관리자: 프로젝트 단위 Editor/서비스별 역할 — Billing Account 역할 미부여
*   예시 CLI(프로젝트 Viewer 바인딩)

```
gcloud projects add-iam-policy-binding <PROJECT_ID> \
  --member=user:<EMAIL> --role=roles/viewer
```

3) 예산/알림 설정(권장)
----------------

*   스크립트: `cloud_basic/automation/cli/budget/gcp_budget.sh`
*   실행 예:

```
setx PROJECT_ID <GCP_PROJECT_ID>
setx BILLING_ACCOUNT <GCP_BILLING_ACCOUNT_ID>
THRESHOLD_PERCENT=80 BUDGET_AMOUNT=10 bash cloud_basic/automation/cli/budget/gcp_budget.sh
```

4) CLI 초기화
---------

*   `gcloud auth login` → `gcloud config set project <PROJECT_ID>`

5) 검증
------

*   `gcloud auth list`, `gcloud config get-value project` 확인
*   비용관리자: 결제 계정 권한은 있으나 프로젝트 리소스 변경 금지
*   IT 관리자: 프로젝트 리소스 조작 가능, Billing 권한 없음

Azure 계정 등록 및 초기 설정
------------------

1) 구독/보안
--------

*   Azure 구독 생성/할당, Entra ID MFA/조건부 접근 구성

2) 역할 할당(권장 모델)
----------------

*   비용관리자: Billing Reader(결제 스코프), Cost Management Reader/Contributor(필요 시)
*   IT 관리자: Subscription/Resource Group `Contributor`(또는 서비스별 제한 역할)

3) 예산/알림 설정(권장)
----------------

*   스크립트: `cloud_basic/automation/cli/budget/azure_budget.sh`
*   실행 예:

```
setx SUB_ID <AZURE_SUBSCRIPTION_ID>
THRESHOLD_PERCENT=80 BUDGET_AMOUNT=10 CONTACT_EMAILS=you@example.com bash cloud_basic/automation/cli/budget/azure_budget.sh
```

4) CLI 초기화(선택)
-------------

*   `az login` 후 구독 컨텍스트 설정: `az account set --subscription <SUB_ID>`

CLI 자동화 스크립트(선택)
----------------

*   IAM 기본 설정 자동화(권장: 실제 실습 전 미리 실행)
    *   AWS: `cloud_basic/automation/cli/aws/ch1_iam.sh`
    *   GCP: `cloud_basic/automation/cli/gcp/ch1_iam.sh`
    *   Azure: `cloud_basic/automation/cli/azure/ch1_iam.sh`
*   실행 전 주의: `ROLE=cost-manager`인 상태에서는 스크립트가 거부됩니다.

추가: Terraform 가드(권장)
-----------------

*   비용관리자 역할에서 Terraform 예제를 실행하지 않도록 가드 스크립트를 제공합니다.
*   경로: `cloud_basic/automation/terraform/guard.sh`
*   사용 예(모듈 디렉토리에서 실행 전):

```
source ../../guard.sh || . ../../guard.sh
terraform init && terraform plan
```

```
chmod +x cloud_basic/automation/cli/aws/*.sh
AWS_PROFILE=default AWS_REGION=ap-northeast-2 bash cloud_basic/automation/cli/aws/ch1_iam.sh
```

환경변수 예(Windows)
-------------

```
setx AWS_PROFILE default
setx AWS_REGION ap-northeast-2
setx PROJECT_ID <GCP_PROJECT_ID>
setx BILLING_ACCOUNT <GCP_BILLING_ACCOUNT_ID>
setx SUB_ID <AZURE_SUBSCRIPTION_ID>
```

검증 체크리스트(요약)
--------------

*   MFA 등록 완료(루트/오너 포함), 액세스 키 남용 없음
*   비용관리자/IT 관리자 역할 분리 검증(서로의 금지 영역 접근 차단)
*   예산 생성 및 알림 규칙 적용 확인(AWS/GCP/Azure)
*   CLI로 Caller/Project/Subscription 확인 및 기본 조회 명령 성공
*   태깅/라벨 표준 및 명명 규칙 합의(팀 공유)

트러블슈팅
------

*   권한 거부: 스코프/상속/권한 경계(permissions boundary)/정책 조건(시간/IP) 확인
*   Billing 권한/프로젝트 권한 혼동: 결제 스코프와 리소스 스코프는 별도임에 유의
*   SSO/CLI 이슈: 캐시 초기화(`aws sso logout`, `gcloud auth revoke --all`), 재로그인

제출물(권장)
--------

*   MFA 활성화 스크린샷(민감정보 마스킹)
*   예산 생성 화면/CLI 출력 캡처
*   역할 분리 검증 결과(비용관리자/IT 관리자 각각 금지/허용 사례 1건 이상)
*   환경 변수/프로파일 설정 내용 요약(민감정보 제외)

외부 참고
---------

*   AWS
    *   [IAM 시작하기](https://docs.aws.amazon.com/IAM/latest/UserGuide/introduction.html)
    *   [MFA 설정](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_mfa.html)
    *   [AWS Budgets](https://docs.aws.amazon.com/cost-management/latest/userguide/budgets-managing-costs.html)
*   Azure
    *   [Azure AD(Entra) MFA](https://learn.microsoft.com/entra/identity/authentication/tutorial-enable-azure-mfa)
    *   [Azure Cost Management 예산](https://learn.microsoft.com/azure/cost-management-billing/costs/quick-create-budget)
*   GCP
    *   [프로젝트와 결제 연결](https://cloud.google.com/billing/docs/how-to/modify-project?hl=ko)
    *   [Billing Budget](https://cloud.google.com/billing/docs/how-to/budgets)

참고: 다음 단계
---------

*   [Chapter1_IAM.md](mdc:mcp_knowledge_base/cloud_basic/Chapter1_IAM.md) 실습 진행
*   [실습_시나리오.md](mdc:mcp_knowledge_base/cloud_basic/실습_시나리오.md)를 따라 VM/스토리지/네트워크 순으로 진행


